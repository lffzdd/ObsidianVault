---
aliases: 1.1.3-纹理相似度和形状相似度
tags: []
date created: Monday, August 26th 2024, 4:15:29 pm
date modified: Monday, August 26th 2024, 4:31:14 pm
---
纹理相似度和形状相似度在选择性搜索算法中用于度量两个区域在纹理和形状方面的相似性，从而帮助判断是否应该将这两个区域合并。下面是这些相似度的具体计算方法：
### 1. 纹理相似度（Texture Similarity）
**定义**：纹理相似度衡量两个区域在纹理特征上的相似程度。纹理特征可以通过不同的方式计算，常见的包括使用灰度共生矩阵（Gray Level Co-occurrence Matrix, GLCM）、局部二值模式（Local Binary Pattern, LBP）、梯度方向直方图（Histogram of Oriented Gradients, HOG）等。
**计算方法**：
- **特征提取**：首先从每个区域中提取纹理特征。举例来说，可以计算每个区域的纹理直方图，如梯度方向直方图（HOG）。这将为每个区域生成一个特征向量，表示该区域的纹理信息。
- **相似度计算**：然后计算两个区域的特征向量之间的相似度。常见的方法包括计算欧几里得距离、余弦相似度或直方图交叉熵。以欧几里得距离为例，设$T_i$和$T_j$分别是两个区域的纹理特征向量，相似度可以表示为：
$$
  S_{texture}(R_i, R_j) = -\|T_i - T_j\|
$$
  这里的负号表示距离越小，相似度越高。
### 2. 形状相似度（Shape Similarity）
**定义**：形状相似度用于衡量两个区域在形状上的相似性。形状相似度的计算通常基于区域的几何特征，例如区域的外边界、面积、周长等。
**计算方法**：
- **矩特征**：常见的方法是使用图像矩（Moments）来描述形状特征。特别是，Hu 矩（Hu Moments）是旋转、缩放和平移不变的，可以用来描述形状。对于每个区域，可以计算它的 Hu 矩特征向量$H_i$和$H_j$。
- **相似度计算**：然后计算这两个 Hu 矩特征向量之间的距离。通常使用欧几里得距离来表示形状相似度：
$$
  S_{shape}(R_i, R_j) = -\|H_i - H_j\|
$$
  同样，这里的负号表示距离越小，形状相似度越高。
### 示例
假设我们有两个区域$R_i$和$R_j$，它们的纹理特征可以通过 HOG 提取，形状特征可以通过 Hu 矩提取：
1. **纹理相似度**：
   - 计算$R_i$和$R_j$的 HOG 特征向量$T_i$和$T_j$。
   - 计算它们的欧几里得距离：$S_{texture}(R_i, R_j) = -\|T_i - T_j\|$。
2. **形状相似度**：
   - 计算$R_i$和$R_j$的 Hu 矩特征向量$H_i$和$H_j$。
   - 计算它们的欧几里得距离：$S_{shape}(R_i, R_j) = -\|H_i - H_j\|$。
最终，通过结合纹理相似度、形状相似度以及其他相似度（如颜色相似度和大小相似度），算法会综合判断两个区域是否应该合并。
# 纹理相似度 - 梯度方向直方图
梯度方向直方图（Histogram of Oriented Gradients, HOG）是一种用于描述图像局部纹理和形状的特征表示方法。HOG 通过计算图像局部的梯度方向直方图，捕捉图像的边缘信息，并生成一个特征向量。下面是 HOG 特征的计算步骤。
### HOG 特征计算步骤
1. **灰度化（Grayscale Conversion）**：
   - 如果输入图像是彩色图像，首先需要将其转换为灰度图像。灰度图像的每个像素只包含一个亮度值，从而简化计算。
2. **计算图像梯度（Compute Gradients）**：
   - 对图像进行梯度计算，得到每个像素的梯度幅值和梯度方向。
   - 常用的梯度计算方式是使用 Sobel 算子对图像进行卷积：
     - 水平方向梯度：$G_x = I * S_x$
     - 垂直方向梯度：$G_y = I * S_y$
     其中$I$是灰度图像，$S_x$和$S_y$分别是水平和垂直方向上的 Sobel 算子。
   - 计算每个像素的梯度幅值$G$和方向$\theta$：
   $$
     G = \sqrt{G_x^2 + G_y^2}
   $$
   $$
     \theta = \arctan\left(\frac{G_y}{G_x}\right)
   $$
   - 梯度方向$\theta$通常限制在 0 到 180 度范围内。
3. **划分图像块和单元（Divide Image into Cells and Blocks）**：
   - 图像被划分成若干小的单元（cell），每个单元通常为 8x8 像素。
   - 多个单元（如$2 \times 2$）组成一个块（block）。块用于归一化（normalization），提高特征的抗光照变化能力。
4. **计算每个单元的梯度方向直方图（Compute Histogram of Gradients for Each Cell）**：
   - 对每个单元内的像素，根据其梯度方向，将该像素的梯度幅值累积到相应的方向直方图的桶（bin）中。
   - 直方图的方向通常分为 9 个方向桶（bin），即每 20 度一个桶。
   - 每个单元的梯度方向直方图由 9 个桶的值组成。
5. **块归一化（Block Normalization）**：
   - 对于每个块中的所有单元的梯度直方图，进行归一化处理，减少光照影响。常用的归一化方法包括$L2$范数和$L2$-Hys 范数。
   - 归一化后的块特征向量连接成一个更长的特征向量。
6. **特征向量形成（Feature Vector Formation）**：
   - 将图像中所有块的特征向量串联起来，形成整个图像的 HOG 特征向量。
   - 这个特征向量可以用作图像分类、物体检测等任务的输入。
### 示例：计算一个 2x2 单元块的 HOG 特征
假设我们有一个 16x16 的灰度图像，我们将其划分为 4 个 8x8 的单元。每个单元的梯度方向直方图由 9 个桶组成。
1. **计算每个像素的梯度幅值和方向**。
2. **为每个单元计算梯度方向直方图**。每个单元的直方图是一个 9 维向量。
3. **对每个块的直方图进行归一化**。假设我们有一个 2x2 的块，它包含 4 个 9 维向量，归一化后形成一个 36 维的块特征向量。
4. **连接所有块的特征向量**，形成最终的 HOG 特征向量。
通过这些步骤，我们最终得到了一个描述图像局部梯度分布的特征向量，这个向量可以用于进一步的图像处理任务，如分类或检测。
# 形状相似度 -Hu 矩
Hu 矩（Hu Moments）是一组基于图像几何矩的不变矩，它们对于图像的旋转、缩放和平移具有不变性，常用于描述图像的形状特征。Hu 矩特征向量是通过计算一组由图像的几何矩导出的不变量来获得的。
### 1. 几何矩（Geometric Moments）
首先，我们计算图像的几何矩$M_{pq}$，其中$p$和$q$是非负整数。对于一个二维离散图像$I(x, y)$，几何矩定义为：
$$
M_{pq} = \sum_{x} \sum_{y} x^p y^q I(x, y)
$$
- $M_{00}$ 是图像的零阶矩，表示图像的总强度（对于二值图像，表示图像中前景像素的总数）。
- $M_{10}$ 和 $M_{01}$ 是图像的一阶矩，分别用于计算图像的质心坐标。
### 2. 图像质心（Centroid）
图像的质心$(\bar{x}, \bar{y})$通过一阶矩计算得到：
$$
\bar{x} = \frac{M_{10}}{M_{00}}, \quad \bar{y} = \frac{M_{01}}{M_{00}}
$$
### 3. 中心矩（Central Moments）
为了使矩对图像的平移不敏感，我们使用中心矩$\mu_{pq}$，它基于图像质心计算：
$$
\mu_{pq} = \sum_{x} \sum_{y} (x - \bar{x})^p (y - \bar{y})^q I(x, y)
$$
- 中心矩$\mu_{00}$是图像的归一化面积，不随图像的平移变化。
- 高阶的中心矩捕捉了图像的形状分布，计算时减去了质心坐标，消除了平移影响。
### 4. 归一化中心矩（Normalized Central Moments）
为了进一步消除缩放的影响，中心矩被归一化为无量纲形式：
$$
\eta_{pq} = \frac{\mu_{pq}}{\mu_{00}^{\gamma}}, \quad \text{其中} \quad \gamma = \frac{p + q}{2} + 1
$$
这里$\eta_{pq}$是归一化的中心矩，$\gamma$是归一化因子。
### 5. Hu 不变矩（Hu Invariant Moments）
Hu 矩是基于归一化中心矩的七个不变量的组合。Hu 在他的论文中提出了这七个不变矩，它们对图像的旋转、缩放和平移不变。这些不变矩表示为：
$$
\text{Hu}_1 = \eta_{20} + \eta_{02}
$$
$$
\text{Hu}_2 = (\eta_{20} - \eta_{02})^2 + 4\eta_{11}^2
$$
$$
\text{Hu}_3 = (\eta_{30} - 3\eta_{12})^2 + (3\eta_{21} - \eta_{03})^2
$$
$$
\text{Hu}_4 = (\eta_{30} + \eta_{12})^2 + (\eta_{21} + \eta_{03})^2
$$
$$
\text{Hu}_5 = (\eta_{30} - 3\eta_{12})(\eta_{30} + \eta_{12})[(\eta_{30} + \eta_{12})^2 - 3(\eta_{21} + \eta_{03})^2] + (3\eta_{21} - \eta_{03})(\eta_{21} + \eta_{03})[3(\eta_{30} + \eta_{12})^2 - (\eta_{21} + \eta_{03})^2]
$$
$$
\text{Hu}_6 = (\eta_{20} - \eta_{02})[(\eta_{30} + \eta_{12})^2 - (\eta_{21} + \eta_{03})^2] + 4\eta_{11}(\eta_{30} + \eta_{12})(\eta_{21} + \eta_{03})
$$
$$
\text{Hu}_7 = (3\eta_{21} - \eta_{03})(\eta_{30} + \eta_{12})[(\eta_{30} + \eta_{12})^2 - 3(\eta_{21} + \eta_{03})^2] - (\eta_{30} - 3\eta_{12})(\eta_{21} + \eta_{03})[3(\eta_{30} + \eta_{12})^2 - (\eta_{21} + \eta_{03})^2]
$$
这七个 Hu 矩特征构成了一个特征向量，用于描述图像的形状。
### 总结
通过 Hu 矩的计算，我们可以得到一个 7 维的特征向量，该特征向量在图像的旋转、缩放和平移下保持不变。这使得 Hu 矩成为描述图像形状特征的强大工具，常用于模式识别和计算机视觉应用中。
