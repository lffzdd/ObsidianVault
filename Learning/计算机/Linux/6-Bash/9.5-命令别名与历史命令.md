---
aliases: 9.5-命令别名与历史命令
tags:
date created: 星期五, 十月 11日 2024, 11:13:32 晚上
date modified: 星期五, 十月 11日 2024, 11:20:38 晚上
---
## 设定命令别名
- `alias`：设定命令别名，例如 `alias lm='ls -al | more'`
- `unalias`：取消命令别名，`alias lm`
## 查看历史命令
- `history`：查看历史命令
```shell
[dmtsai@study ~]$ history [n]
[dmtsai@study ~]$ history [-c]
[dmtsai@study ~]$ history [-raw] histfiles
选项与参数：
n ：数字，意思是『要列出最近的 n 笔命令行表』的意思！
-c ：将目前的 shell 中的所有 history 内容全部消除
-a ：将目前新增的 history 指令新增入 histfiles 中，若没有加 histfiles ，
则预设写入 ~/.bash_history
-r ：将 histfiles 的内容读到目前这个 shell 的 history 记忆中；
-w ：将目前的 history 记忆内容写入 histfiles 中！
```
在正常的情况下，历史命令的读取与记录是这样的：
- 当我们以 bash 登入 Linux 主机之后，系统会主动的由家目录的 `~/.bash_history` 读取以前曾经下过的指令，那么 `~/.bash_history` 会记录几笔数据呢？这就与你 bash 的 `$HISTFILESIZE` 这个变量设定值有关了！
- 假设我这次登入主机后，共下达过 100 次指令，『等我注销时，系统就会将 101~1100 这总共 1000 笔历史命令更新到 ~/.bash_history 当中。』 也就是说，历史命令在我注销时，会将最近的 `HISTFILESIZE` 笔记录到我的纪录文件当中啦！
- 当然，也可以用 `history -w` 强制立刻写入的！那为何用『更新』两个字呢？ **因为 `~/.bash_history` 记录的笔数永远都是 `HISTFILESIZE` 那么多，旧的讯息会被主动的拿掉**！ 仅保留最新的！
### 执行历史命令
- `!num`：执行第 `num` 笔指令
- `!command`：由最近的指令向前搜寻『指令串开头为 command』的那个指令，并执行
```shell
[dmtsai@study ~]$ !number
[dmtsai@study ~]$ !command
[dmtsai@study ~]$ !!
选项与参数：
number ：执行第几笔指令的意思；
command ：由最近的指令向前搜寻『指令串开头为 command』的那个指令，并执行；
!! ：就是执行上一个指令(相当于按↑按键后，按 Enter)
[dmtsai@study ~]$ history
66 man rm
67 alias
68 man history
69 history
[dmtsai@study ~]$ !66 <==执行第 66 笔指令
[dmtsai@study ~]$ !! <==执行上一个指令，本例中亦即 !66
[dmtsai@study ~]$ !al <==执行最近以 al 为开头的指令(上头列出的第 67 个)
```
### 同一账号同时多次登入的 history 写入问题
有些朋友在练习 linux 的时候喜欢同时开好几个 bash 接口，这些 bash 的身份都是 root 。 这样会有 ~/.bash_history 的写入问题吗？想一想，因为这些 bash 在同时以 root 的身份登入， 因此所有的 bash 都有自己的 1000 笔记录在内存中。因为等到注销时才会更新记录文件，所以啰， **最后注销的那个 bash 才会是最后写入的数据**。唔！如此一来其他 bash 的指令操作就不会被记录下来了 (其实有被记录，只是被后来的最后一个 bash 所覆盖更新了) 。由于多重登入有这样的问题，所以很多朋友都习惯单一 bash 登入，再用工作控制 (job control, 第四篇会介绍) 来切换不同工作！ 这样才能够将所有曾经下达过的指令记录下来，也才方便未来系统管理员进行指令的 debug 啊！
### 无法记录时间
历史命令还有一个问题，那就是无法记录指令下达的时间。由于这 1000 笔历史命令是依序记录的，但是并没有记录时间，所以在查询方面会有一些不方便。如果读者们有兴趣，其实**可以透过~/.bash_logout 来进行 history 的记录，并加上 date 来增加时间参数**，也是一个可以应用的方向喔！有兴趣的朋友可以先看看情境模拟题一吧！