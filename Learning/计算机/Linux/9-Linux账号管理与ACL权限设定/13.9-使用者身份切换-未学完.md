身份变换有几个原因:
- 使用一般账号：系统平日操作的好习惯
事实上，为了安全的缘故，一些老人家都会建议你，尽量以一般身份使用者来操作 Linux 的日常作业！等到需要设定系统环境时， 才变换身份成为 root 来进行系统管理，相对比较安全啦！避免作错一些严重的指令，例如恐怖的『 rm -rf / 』(千万作不得！)
- 用较低权限启动系统服务
相对于系统安全，有的时候，我们必须要以某些系统账号来进行程序的执行。 举例来说， Linux主机上面的一套软件，名称为 apache ，我们可以额外建立一个名为 apache 的用户来启动 apache软件啊，如此一来，如果这个程序被攻破，至少系统还不至于就损毁了～
- 软件本身的限制
在远古时代的 telnet 程序中，该程序默认是不许使用 root 的身份登入的，telnet 会判断登入者的UID，若 UID 为 0 的话，那就直接拒绝登入了。所以，你只能使用一般使用者来登入 Linux 服务器。此外， ssh(注 3) 也可以设定拒绝 root 登入喔！那如果你有系统设定需求该如何是好啊？就变换身份啊！
---
由于上述考虑，所以我们都是使用一般账号登入系统的，等有需要进行系统维护或软件更新时才转为root 的身份来动作。 那如何让一般使用者转变身份成为 root 呢？主要有两种方式喔：
- 以『 su - 』直接将身份变成 root 即可，但是这个指令却需要 root 的密码，也就是说，如果你要以 su 变成 root 的话，你的一般使用者就必须要有 root 的密码才行；
- 以『 sudo 指令 』执行 root 的指令串，由于 sudo 需要事先设定妥当，且 sudo 需要输入用户自己的密码，因此多人共管同一部主机时， sudo 要比 su 来的好喔！至少 root 密码不会流出去！
# `su`
su 是最简单的身份切换指令了，他可以进行任何身份的切换唷！方法如下：
```shell
[root@study ~]# su [-lm] [-c 指令] [username]
选项与参数：
- ：单纯使用 - 如『 su - 』代表使用 login-shell 的变量文件读取方式来登入系统；
若使用者名称没有加上去，则代表切换为 root 的身份。
-l ：与 - 类似，但后面需要加欲切换的使用者账号！也是 login-shell 的方式。
-m ：-m 与 -p 是一样的，表示『使用目前的环境设定，而不读取新使用者的配置文件』
-c ：仅进行一次指令，所以 -c 后面可以加上指令喔！
```
## 范例 1
上表的解释当中有出现之前第十章谈过的 login-shell 配置文件读取方式，如果你忘记那是啥东西，请先回去第十章瞧瞧再回来吧！这个 su 的用法当中，有没有加上那个减号『 - 』差很多喔！因为涉及 login-shell 与 non-login shell 的变量读取方法。这里让我们以一个小例子来说明吧！
```shell
范例一：假设你原本是 dmtsai 的身份，想要使用 non-login shell 的方式变成 root
[dmtsai@study ~]$ su <==注意提示字符，是 dmtsai 的身份喔！
Password: <==这里输入 root 的密码喔！
[root@study dmtsai]# id <==提示字符的目录是 dmtsai 喔！
uid=0(root) gid=0(root) groups=0(root) context=unconf…. <==确实是 root 的身份！
[root@study dmtsai]# env | grep 'dmtsai'
USER=dmtsai <==竟然还是 dmtsai 这家伙！
PATH=…:/home/dmtsai/.local/bin:/home/dmtsai/bin <==这个影响最大！
MAIL=/var/spool/mail/dmtsai <==收到的 mailbox 是 vbird1
PWD=/home/dmtsai <==并非 root 的家目录
LOGNAME=dmtsai
# 虽然你的 UID 已经是具有 root 的身份，但是看到上面的输出讯息吗？
# 还是有一堆变量为原本 dmtsai 的身份，所以很多数据还是无法直接利用。
[root@study dmtsai]# exit <==这样可以离开 su 的环境！
```

## 范例 2
==单纯使用『 su 』切换成为 root 的身份，读取的变量设定方式为 non-login shell 的方式，这种方式很多原本的变量不会被改变==，尤其是我们之前谈过很多次的 PATH 这个变量，由于没有改变成为root 的环境，因此很多 root 惯用的指令就只能使用绝对路径来执行咯。其他的还有 MAIL 这个变量，你输入 mail 时，收到的邮件竟然还是 dmtsai 的，而不是 root 本身的邮件！是否觉得很奇怪啊！所以切换身份时，请务必使用如下的范例二：
```shell
范例二：使用 login shell 的方式切换为 root 的身份并观察变量
[dmtsai@study ~]$ su -
Password: <==这里输入 root 的密码喔！
[root@study ~]# env | grep root
USER=root
MAIL=/var/spool/mail/root
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
PWD=/root
HOME=/root
LOGNAME=root
# 了解差异了吧？下次变换成为 root 时，记得最好使用 su - 喔！
[root@study ~]# exit <==这样可以离开 su 的环境！
```
## 范例 3
上述的作法是让使用者的身份变成 root 并开始操作系统，如果想要离开 root 的身份则得要利用exit 离开才行。那我如果只是想要执行『一个只有 root 才能进行的指令，且执行完毕就恢复原本的身份』呢？那就可以加上 -c 这个选项啰！请参考底下范例三！
```shell
范例三：dmtsai 想要执行『 head -n 3 /etc/shadow 』一次，且已知 root 密码
[dmtsai@study ~]$ head -n 3 /etc/shadow
head: cannot open `/etc/shadow` for reading: Permission denied
[dmtsai@study ~]$ su - -c "head -n 3 /etc/shadow"
Password: <==这里输入 root 的密码喔！
root:$6$wtbCCce/PxMeE5wm$KE2IfSJr.YLP7Rcai6oa/T7KFhOYO62vDnqfLw85…:16559:0:99999:7:::
bin:*:16372:0:99999:7:::
daemon:*:16372:0:99999:7:::
[dmtsai@study ~]$ <==注意看，身份还是 dmtsai 喔！继续使用旧的身份进行系统操作！
```
## 范例 4
由于 /etc/shadow 权限的关系，该文件仅有 root 可以查阅。为了查阅该文件，所以我们必须要使 root 的身份工作。但我只想要进行一次该指令而已，此时就使用类似上面的语法吧！好，那接下来，如果我是 root 或者是其他人，想要变更成为某些特殊账号，可以使用如下的方法来切换喔！
```shell
范例四：原本是 dmtsai 这个使用者，想要变换身份成为 vbird1 时？
[dmtsai@study ~]$ su -l vbird1
Password: <==这里输入 vbird1 的密码喔！
[vbird1@study ~]$ su -
Password: <==这里输入 root 的密码喔！
[root@study ~]# id sshd
uid=74(sshd) gid=74(sshd) groups=74(sshd) … <==确实有存在此人
[root@study ~]# su -l sshd
This account is currently not available. <==竟然说此人无法切换？
[root@study ~]# finger sshd
Login: sshd Name: Privilege-separated SSH
Directory: /var/empty/sshd Shell: /sbin/nologin
[root@study ~]# exit <==离开第二次的 su
[vbird1@study ~]$ exit <==离开第一次的 su
[dmtsai@study ~]$ exit <==这才是最初的环境！
```
su 就这样简单的介绍完毕，总结一下他的用法是这样的：
- 若要完整的切换到新使用者的环境，必须要使用『 su - username 』或『 su -l username 』，才会连同PATH/USER/MAIL 等变量都转成新用户的环境；
- 如果仅想要执行一次 root 的指令，可以利用『 su - -c "指令串" 』的方式来处理；
- 使用 root 切换成为任何使用者时，并不需要输入新用户的密码；

# `sudo`
相对于 su 需要了解新切换的用户密码 (常常是需要 root 的密码)， sudo 的执行则仅需要自己的密码即可！ 甚至可以设定不需要密码即可执行 sudo 呢！由于 sudo 可以让你以其他用户的身份执行指令 (通常是使用 root 的身份来执行指令)，因此并非所有人都能够执行 sudo ， 而是仅有规范到/etc/sudoers 内的用户才能够执行 sudo 这个指令喔！说的这么神奇，底下就来瞧瞧那 sudo 如何使用？
>Tips 事实上，一般用户能够具有 sudo 的使用权，就是管理员事先审核通过后，才开放 sudo 的使用权的！因此，除非是信任用户，否则一般用户默认是不能操作 sudo 的喔！

## `sudo` 的指令用法
由于一开始系统默认仅有 root 可以执行 sudo ，因此底下的范例我们先以 root 的身份来执行，等到谈到 visudo 时，再以一般使用者来讨论其他 sudo 的用法吧！ sudo 的语法如下：
>Tips 还记得在安装 CentOS 7 的第三章时，在设定一般账号的项目中，有个『让这位使用者成为管理员』的选项吧？如果你有勾选该选项的话，那除了 root 之外，该一般用户确实是可以使用 sudo 的喔(以鸟哥的例子来说， dmtsai预设竟然可以使用 sudo 了！)！这是因为建立账号的时候，默认将此用户加入 sudo 的支持中了！详情本章稍后告知！

```shell
[root@study ~]# sudo [-b] [-u 新使用者账号]
选项与参数：
-b ：将后续的指令放到背景中让系统自行执行，而不与目前的 shell 产生影响
-u ：后面可以接欲切换的使用者，若无此项则代表切换身份为 root 。
范例一：你想要以 sshd 的身份在 /tmp 底下建立一个名为 mysshd 的文件
[root@study ~]# sudo -u sshd touch /tmp/mysshd
[root@study ~]# ll /tmp/mysshd
-rw-r--r--. 1 sshd sshd 0 Jul 21 23:37 /tmp/mysshd
# 特别留意，这个文件的权限是由 sshd 所建立的情况喔！
范例二：你想要以 vbird1 的身份建立 ~vbird1/www 并于其中建立 index.html 文件
[root@study ~]# sudo -u vbird1 sh -c "mkdir ~vbird1/www; cd ~vbird1/www; \
> echo 'This is index.html file' > index.html"
[root@study ~]# ll -a ~vbird1/www
drwxr-xr-x. 2 vbird1 vbird1 23 Jul 21 23:38 .
drwx------. 6 vbird1 vbird1 4096 Jul 21 23:38 ..
-rw-r--r--. 1 vbird1 vbird1 24 Jul 21 23:38 index.html
# 要注意，建立者的身份是 vbird1 ，且我们使用 sh -c "一串指令" 来执行的！
```