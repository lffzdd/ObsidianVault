认识了账号相关的两个文件 /etc/passwd 与 /etc/shadow 之后，你或许还是会觉得奇怪，那么群组的配置文件在哪里？还有，在 /etc/passwd 的第四栏不是所谓的 GID 吗？那又是啥？ 呵呵～此时就需要了解 /etc/group 与 /etc/gshadow 啰～
# /etc/group 文件结构
这个文件就是在记录 GID 与组名的对应了～鸟哥测试机的 /etc/group 内容有点像这样：
```shell
[root@study ~]# head -n 4 /etc/group
root:x:0:
bin:x:1:
daemon:x:2:
sys:x:3:

组名:组密码:GID:支持账号
```
这个文件每一行代表一个群组，也是以冒号『:』作为字段的分隔符，共分为四栏，每一字段的意义是：
1. 组名：
就是组名啦！同样用来给人类使用的，基本上需要与第三字段的 GID 对应。
2. 群组密码：
通常不需要设定，这个设定通常是给『群组管理员』使用的，目前很少有这个机会设定群组管理员啦！ 同
样的，密码已经移动到 /etc/gshadow 去，因此这个字段只会存在一个『x』而已；
3. GID：
就是群组的 ID 啊。我们 /etc/passwd 第四个字段使用的 GID 对应的群组名，就是由这里对应出来的！
4. 此群组支持的账号名称：
我们知道一个账号可以加入多个群组，那某个账号想要加入此群组时，将该账号填入这个字段即可。举例来说，如果我想要让 dmtsai 与 alex 也加入 root 这个群组，那么在第一行的最后面加上『dmtsai,alex』，注意不要有空格，使成为『 root:x:0: dmtsai,alex 』就可以啰～谈完了 /etc/passwd, /etc/shadow, /etc/group 之后，我们可以使用一个简单的图示来了解一下 UID /GID 与密码之间的关系，图示如下。其实重点是 /etc/passwd 啦，其他相关的数据都是根据这个文件的字段去找寻出来的。下图中， root 的 UID 是 0 ，而 GID 也是 0 ，去找 /etc/group 可以知道 GID 为 0 时的组名就是 root 哩。至于密码的寻找中，会==找到 /etc/shadow 与 /etc/passwd 内同账号名称的那一行==，就是密码相关数据啰。![[Pasted image 20241028120522.png]]
- 找 GID 时, 通过 GID 匹配
- 找密码时, 通过名称匹配, 因为/etc/shadow 内没有 uid
## 初始群组(initial group) 与有效群组(effective group)
在 /etc/group 比较重要的特色在于第四栏，因为每个使用者都可以拥有多个支持的群组,假如我同时加入多个群组，那么我在作业的时候，到底是以那个群组为准？底下我们就来谈一谈这个『有效群组』的概念
>新版的 Linux 中，初始群组的用户群已经不会加入在第四个字段！例如我们知道 root 这个账号的主要群组为 root，但是在上面的范例中， 你已经不会看到 root 这个『用户』的名称在 /etc/group 的 root 那一行的第四个字段内

/etc/passwd 里面的第四栏有所谓的 GID ,那个 GID 就是所谓的『初始群组 (initial group) 』！也就是说，当用户一登入系统，立刻就拥有这个群组的相关权限
==初始群组，使用者一登入就会主动取得，不需要在 /etc/group 的第四个字段写入该账号==
非 initial group 的其他群组可就不同了。举上面这个例子来说，我将 dmtsai 加入 users 这个群组当中，由于 users 这个群组并非是 dmtsai 的初始群组，因此，我必须要在 /etc/group 这个文件中，找到 users 那一行，并且将 dmtsai 这个账号加入第四栏，这样 dmtsai 才能够加入 users 这个群组啊。
- & 系统登陆时会读取 passwd 取得第四个字段 GID 初始群组, 然后通过 GID 匹配到 group 文件内读取相应用户的第四个字段取得用户所在的其他群组
### `gruops`:有效与支持群组的观察
```shell
[dmtsai@study ~]$ groups
dmtsai wheel users
```
在这个输出的讯息中，可知道 dmtsai 这个用户同时属于 dmtsai, wheel 及 users 这三个群组， ==第一个输出的群组即为有效群组== (effective group) 了。 也就是说，我的有效群组为 dmtsai 啦～
==此时，如果我以 touch 去建立一个新档，例如： 『 touch test 』，那么这个文件的拥有者为 dmtsai ，而且群组也是 dmtsai 的啦==。
### `newgrp`: 有效群组的切换
那么如何变更有效群组呢？就使用 newgrp 啊！不过使用 newgrp 是有限制的，那就是==你想要切换的群组必须是你已经有支持的群组==。举例来说， dmtsai 可以在 dmtsai/wheel/users 这三个群组间切换有效群组，但是 dmtsai 无法切换有效群组成为 sshd 啦！使用的方式如下：
```shell
[dmtsai@study ~]$ newgrp users
[dmtsai@study ~]$ groups
users wheel dmtsai
[dmtsai@study ~]$ touch test2
[dmtsai@study ~]$ ll test*
-rw-rw-r--. 1 dmtsai dmtsai 0 Jul 20 19:54 test
-rw-r--r--. 1 dmtsai users 0 Jul 20 19:56 test2
[dmtsai@study ~]$ exit # 注意！记得离开 newgrp 的环境喔！
```
这个指令可以变更目前用户的有效群组，而且是另外以一个 shell 来提供这个功能，所以，以上面的例子来说， dmtsai 这个使用者目前是==以另一个 shell 登入的==，而且新的 shell 给予 dmtsai 有效 GID 为users ![[Pasted image 20241028122805.png]]
用户的环境设定(例如环境变量等等其他数据)不会有影响，但是使用者的『群组权限』将会重新被计算。但是需要注意，由于是新取得一个 shell ，因此如果你想要回到原本的环境中，请输入 exit 回到原本的 shell 喔！
**newgrp是暂时更换有效群组，下次登录时依旧是原本的有效群组**。
只要我的用户有支持的群组就是能够切换成为有效群组！好了，那么如何让一个账号加入不同的群组?
一个是透过系统管理员(root) 利用 `usermod` 帮你加入，如果 root 太忙了而且你的系统有设定群组管理员，那么你可以透过群组管理员以 `gpasswd` 帮你加入他所管理的群组中
# /etc/gshadow 文件
```shell
[root@study ~]# head -n 4 /etc/gshadow
root:::
bin:::
daemon:::
sys:::

组名:组管理密码:组管理员账号:组支持账号,与/etc/group相同
```
![[Pasted image 20241028124312.png]]
以系统管理员的角度来说，这个 gshadow 最大的功能就是建立群组管理员.
由于目前有类似 sudo 之类的工具，所以这个群组管理员的功能已经很少使用了。
