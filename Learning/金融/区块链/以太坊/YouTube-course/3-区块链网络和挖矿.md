![[Pasted image 20250416002626.png]]
以太坊网络由节点组成, 我们通过节点连接到网络
首先, 将客户端连接到一个节点, 然后客户端就可以通过节点将交易发送到以太坊网络中
节点会将收到的交易发送给其它节点, 每个节点都会收到交易
# 挖矿
每个节点都会将收到的交易存储到一个内存池中, 这个内存池就是交易池, 并且会将交易池中的交易打包成区块
![[Pasted image 20250416003452.png]]
要生成一个有效的区块, 节点需要满足两个条件:
1. 交易池中的交易必须是有效的, 也就是交易必须是合法的, 节点会验证交易的合法性
2. 节点需要进行计算, 计算的结果必须满足网络的难度要求, 计算的结果被称为工作量证明
每当节点成功计算出一个有效的区块, 节点就会将这个区块添加到自己的区块链中: ![[Pasted image 20250416004105.png]]
并将这个区块发送给它们所连接的所有节点, 其它节点收到时首先会验证这个区块的合法性, 如果合法就将这个区块添加到自己的区块链中: ![[Pasted image 20250416004322.png]]
生成有效区块并将其添加到区块链的节点被称为矿工, 这个过程被称为挖矿

计算的结果是一个随机数, 这个随机数是通过 `nonce` 字段计算出来的, 是 `nonce` 和区块头信息拼接在一起后的哈希得到的值, 它需要小于当前网络设定的 `target` 值
通俗地说： **矿工就是在反复尝试不同的 nonce，使得 `SHA256(SHA256(Block Header))` 的结果以足够多的零开头。**
工作量证明就是计算的结果, 它只证明了工作, 但是不证明工作量, 工作量是基于挖出的区块链数量来进行比较的, 即**最长链优先**.
# 区块链
下图是一个高度概括图, 并非实际上完整的区块链, `solution` 字段也并不存在 ![[Pasted image 20250416004738.png]]
`parent hash` 维持了区块链的前后顺序, 每个节点就这一条链达成共识

并非每个节点都想挖出新区块, 比如有个节点只想监听传入的交易, 也许它们有一些类似 API 的服务, 向人们提供数据
以太坊正在淘汰工作量证明 (proof of work, PoW) 的共识机制, 转向权益证明 (proof of stake, PoS) 的共识机制, 一个主要原因是可以减少能源的消耗